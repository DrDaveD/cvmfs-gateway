{erl_opts, [debug_info]}.
{deps, [
        {lager, "3.5.2"},
        {cowboy, "2.1.0"},
        {jsx, "2.8.3"},
        {uuid, "1.7.2", {pkg, uuid_erl}},
        {poolboy, "1.5.1"},
        {lager_syslog, {git, "https://github.com/cvmfs/lager_syslog.git", {tag, "3.0.3"}}}
       ]}.
{relx, [{release, {cvmfs_services, "0.1.10"}
        ,[cvmfs_services,
          mnesia,
          lager,
          lager_syslog,
          cowboy,
          jsx,
          poolboy,
          uuid,
          runtime_tools,
          sasl]}

       ,{sys_config, "./config/sys.config.rel"}
       ,{vm_args, "./config/vm.args"}

       ,{overlay, [{mkdir, "etc"}
                  ,{mkdir, "log"}
                  ,{copy, "./config/repo.config", "etc/repo.config"}
                  ,{copy, "./config/user.config", "etc/user.config"}
                  ,{copy, "./scripts/90-cvmfs_services.conf", "scripts/90-cvmfs_services.conf"}
                  ,{copy, "./scripts/90-cvmfs_services_rotate", "scripts/90-cvmfs_services_rotate"}
                  ,{copy, "./scripts/90-cvmfs_services_rotate_systemd", "scripts/90-cvmfs_services_rotate_systemd"}
                  ,{copy, "./scripts/run_cvmfs_services.sh", "scripts/run_cvmfs_services.sh"}
                  ,{copy, "./scripts/get_leases.sh",      "scripts/get_leases.sh"}
                  ,{copy, "./scripts/get_leases.escript", "scripts/get_leases.escript"}
                  ,{copy, "./scripts/clear_leases.sh",      "scripts/clear_leases.sh"}
                  ,{copy, "./scripts/clear_leases.escript", "scripts/clear_leases.escript"}
                  ,{copy, "./scripts/setup.sh", "scripts/setup.sh"}
                  ,{copy, "./scripts/setup_mnesia.escript", "scripts/setup_mnesia.escript"}]}

       ,{dev_mode, true}
       ,{include_erts, false}
       ,{system_libs, false}

       ,{extended_start_script, true}]}.

{ct_opts, [{config, ["./config/ct_repo.config"]}]}.

{profiles, [{prod, [{relx, [{dev_mode, false}
                           ,{include_erts, true}
                           ,{system_libs, true}]}]}
           ,{test, [{deps, [
                            {proper, "1.2.0"},
                            {gun, "1.0.0-pre.2"},
                            {macaroons, "1.0.2", {git, "https://github.com/kzemek/macaroons.git", {tag, "1.0.2"}}}
                           ]}]}]}.

